<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agentic AI Control Plane: An Interactive Guide (V17)</title>
    <link rel="icon" type="image/x-icon" href="https://www.shefing.com/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Stone & Teal -->
    <!-- Application Structure Plan: Stable version with refactored JavaScript to eliminate initialization errors. All content and structures from previous versions are preserved. -->
    <!-- Visualization & Content Choices: All choices remain consistent. Focus of this version is on code stability and correctness. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f4; /* stone-100 */
            color: #292524; /* stone-800 */
        }
        .nav-link {
            transition: color 0.2s, border-bottom-color 0.2s;
            border-bottom: 2px solid transparent;
        }
        .nav-link:hover, .nav-link.active {
            color: #14b8a6; /* teal-500 */
            border-bottom-color: #14b8a6;
        }
        .card {
            background-color: #ffffff;
            border: 1px solid #e7e5e4; /* stone-200 */
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 1100px;
            margin-left: auto;
            margin-right: auto;
            height: 600px;
            max-height: 80vh;
        }
        .timeline-item {
            border-left: 3px solid #5eead4; /* teal-300 */
        }
        .timeline-dot {
            background-color: #14b8a6; /* teal-500 */
        }
        pre {
            background-color: #292524; /* stone-800 */
            color: #f5f5f4; /* stone-100 */
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-size: 0.875rem;
        }
        .demo-step {
            border-left: 3px solid #d6d3d1; /* stone-300 */
            padding-left: 1.5rem;
            position: relative;
        }
        .demo-step::before {
            content: attr(data-icon);
            position: absolute;
            left: -18px;
            top: 0;
            width: 36px;
            height: 36px;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #14b8a6; /* teal-500 */
            color: white;
            font-size: 1.25rem;
            border: 4px solid #f5f5f4; /* stone-100 */
        }
        .info-icon {
            display: inline-block;
            position: relative;
            cursor: pointer;
        }
        .info-icon .tooltip {
            visibility: hidden;
            width: 280px;
            background-color: #292524;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -140px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem;
            font-weight: 500;
        }
        .info-icon:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0 flex items-center">
                    <h1 class="text-xl font-bold text-stone-800">AI Control Plane V17</h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-center space-x-4 text-sm">
                        <a href="#architecture" class="nav-link px-3 py-2 font-medium text-stone-600">Architecture</a>
                        <a href="#gateway" class="nav-link px-3 py-2 font-medium text-stone-600">Gateway</a>
                        <a href="#scanners" class="nav-link px-3 py-2 font-medium text-stone-600">Scanners</a>
                        <a href="#sidecar" class="nav-link px-3 py-2 font-medium text-stone-600">Sidecar</a>
                        <a href="#ebpf" class="nav-link px-3 py-2 font-medium text-stone-600">eBPF</a>
                        <a href="#mcp-enforcement" class="nav-link px-3 py-2 font-medium text-stone-600">MCP Enforcement</a>
                        <a href="#judge-llm" class="nav-link px-3 py-2 font-medium text-stone-600">Judge LLM</a>
                        <a href="#roadmap" class="nav-link px-3 py-2 font-medium text-stone-600">Roadmap</a>
                        
                        <div class="relative group">
                            <button class="nav-link px-3 py-2 font-medium text-stone-600 inline-flex items-center">
                                <span>Policies & Demos</span>
                                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </button>
                            <div class="absolute right-0 pt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 hidden group-hover:block focus-within:block z-50">
                                <div class="py-1">
                                    <a href="#demos" class="block px-4 py-2 text-sm text-stone-700 hover:bg-stone-100">Demo Scenarios</a>
                                    <a href="#custom-scanners" class="block px-4 py-2 text-sm text-stone-700 hover:bg-stone-100">Custom Scanners</a>
                                    <a href="#tool-enforcement" class="block px-4 py-2 text-sm text-stone-700 hover:bg-stone-100">Tool Enforcement SDK</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
        <!-- All content will be injected here by the script -->
    </main>

    <footer class="bg-stone-200 mt-16">
        <div class="container mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-stone-600 text-sm">
            <p>Interactive guide based on the "Architecting a Production-Grade Observability and Control Plane for Agentic AI Systems" report (V17).</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- 1. DATA STORE ---
            const appData = {
                 gatewayScanners: [
                    { scannerName: 'LlamaFirewall: AlignmentCheck', priority: 1, category: 'content', method: 'Model-Based', description: 'An alignment-focused Judge LLM that reviews the LLM\'s final response to ensure it is helpful, harmless, and adheres to predefined content policies.', modelLink: 'https://huggingface.co/meta-llama/LlamaGuard-7b', link: 'https://arxiv.org/abs/2405.16160' },
                    { scannerName: 'LlamaFirewall: PromptGuard', priority: 1, category: 'security', method: 'Model-Based', description: 'A security-focused Judge LLM that analyzes user prompts to detect malicious instructions, prompt injection, and other defense evasion techniques.', modelLink: 'https://huggingface.co/meta-llama/LlamaGuard-7b', link: 'https://arxiv.org/abs/2405.16160' },
                    { scannerName: 'PII Detection (Presidio)', priority: 2, category: 'pii', method: 'Algorithmic', description: 'Uses Microsoft Presidio for high-accuracy Named Entity Recognition (NER) to find and redact a wide range of PII entities.', link: 'https://github.com/microsoft/presidio' },
                    { scannerName: 'Secrets Present', priority: 2, category: 'security', method: 'Algorithmic', description: 'Scans text for patterns that match common API key and secret formats to prevent accidental leakage.', link: 'https://hub.guardrailsai.com/validator/guardrails/secrets_present' },
                    { scannerName: 'URL Reachability', priority: 4, category: 'quality', method: 'Algorithmic', description: 'Extracts all URLs from a response and verifies that they are reachable, preventing dead links.', link: 'https://hub.guardrailsai.com/validator/guardrails/urls_reachable' },
                    { scannerName: 'Emotion Detection', priority: 1, category: 'content', method: 'Model-Based', description: 'Classifies text into emotional categories like joy, sadness, anger, etc. Useful for monitoring conversation tone.', modelLink: 'https://huggingface.co/j-hartmann/emotion-english-distilroberta-base', link: 'https://huggingface.co/j-hartmann/emotion-english-distilroberta-base' },
                    { scannerName: 'NeMo Self-Contradiction Check', priority: 1, category: 'quality', method: 'Model-Based', description: 'Checks if an LLM\'s response contains internally contradictory statements. A key feature of NeMo Guardrails.', link: 'https://github.com/NVIDIA/NeMo-Guardrails' },
                    { scannerName: 'NeMo Jailbreak Detection', priority: 1, category: 'security', method: 'Model-Based', description: 'A specialized model from NeMo Guardrails to detect if an input is an attempt to jailbreak the LLM.', link: 'https://github.com/NVIDIA/NeMo-Guardrails' },
                    { scannerName: 'Valid Range', priority: 4, category: 'quality', method: 'Algorithmic', description: 'Ensures a numerical value falls within a specified minimum and maximum range.', link: 'https://hub.guardrailsai.com/validator/guardrails/valid_range' },
                    { scannerName: 'Valid JSON', priority: 4, category: 'quality', method: 'Algorithmic', description: 'Ensures that an LLM\'s output strictly adheres to a provided JSON schema, crucial for reliable tool use.', link: 'https://hub.guardrailsai.com/validator/guardrails/valid_json' },
                    { scannerName: 'Toxicity & Harmful Language', category: 'content', method: 'Model-Based', description: 'Uses a sentence-transformer model to classify text for toxicity, insults, threats, and other harmful content.', modelLink: 'https://huggingface.co/martin-ha/toxic-comment-model', link: 'https://hub.guardrailsai.com/validator/guardrails/toxic_language' },
                    { scannerName: 'Profanity Filter', category: 'content', method: 'Algorithmic', description: 'A straightforward filter that checks for words against a comprehensive list of profanities.', link: 'https://hub.guardrailsai.com/validator/guardrails/profanity_free' },
                    { scannerName: 'Code Security (Semgrep)', category: 'security', method: 'Algorithmic', description: 'Uses the Semgrep static analysis engine to scan for common security vulnerabilities in generated code.', link: 'https://github.com/semgrep/semgrep' },
                ],
                scannerPriorities: [
                    { priority: 1, title: "Priority 1: Alignment & On-Topic Check", rationale: "This is about ensuring the agent stays true to its purpose. These scanners cover the content, logical consistency, and tone of the agent's responses, which are the core components of alignment. We recommend a defense-in-depth approach for security: the specialized `NeMo Jailbreak` scanner can catch common attacks quickly, while the broader `PromptGuard` can analyze for more novel or nuanced threats." },
                    { priority: 2, title: "Priority 2: Unnecessary Data Disclosure", rationale: "This is a more advanced requirement than simple PII detection; it's about context. While no single off-the-shelf scanner can determine 'necessity,' these scanners are the essential prerequisites. They perform the factual, Stage-1 detection of what sensitive data is present, which is required before a more advanced, custom Judge LLM can perform a contextual check." },
                    { priority: 3, title: "Priority 3: Detect Unreasonable Behaviors (Anomaly Detection)", rationale: "This goal is achieved not by a single scanner, but by using the outputs of quality scanners as metrics for our observability platform. The Sidecar and Observability Backend are the primary tools here, but they rely on the pass/fail signals from scanners like `Valid Range` and `Valid JSON` to establish a baseline of normal behavior and detect significant deviations that indicate a problem." },
                    { priority: 4, title: "Priority 4: Trivial Correctness", rationale: "These scanners cover the fundamental structural and logical integrity of the agent's output. For any agent that uses tools or provides structured data, ensuring the output is well-formed, contains valid values, and includes working links is a critical baseline for quality and reliability. These checks prevent downstream system failures and a poor user experience." }
                ],
                demoScenarios: [], 
                customScanners: {
                    title: "Implementing Custom Business Scanners",
                    intro: "The true power of a control plane is the ability to enforce rules unique to your business. For example, a support agent must never promise a specific delivery date, only a shipping window. This section explores how to implement such a custom scanner.",
                    implementations: [
                        { title: "Approach 1: Keyword & Regex (The Simple Baseline)", pros: "Fast, cheap, and easy to implement for catching obvious violations.", cons: "Brittle. Easily bypassed by synonyms ('arrives by', 'will be there on'). High risk of false positives/negatives.", code: `import re\n\ndef check_delivery_promise(text):\n    patterns = [r"delivery by \\w+", r"arrives on \\d{1,2}/\\d{1,2}"]\n    for p in patterns:\n        if re.search(p, text, re.IGNORECASE):\n            return {"violation": True, "reason": "Contains a delivery promise."}\n    return {"violation": False}` },
                        { title: "Approach 2: Semantic Search (The Smarter Way)", pros: "Far more robust. Catches nuanced phrasing and synonyms by understanding meaning, not just words.", cons: "Requires a sentence-transformer model and a vector comparison, adding some complexity.", code: `# Pseudocode\nfrom sentence_transformers import SentenceTransformer, util\n\nmodel = SentenceTransformer('all-MiniLM-L6-v2')\nforbidden_phrases = ["guaranteed delivery date", "will arrive on", "you will get it by"]\nforbidden_embeddings = model.encode(forbidden_phrases)\n\ndef check_semantic_promise(text):\n    response_embedding = model.encode(text)\n    scores = util.cos_sim(response_embedding, forbidden_embeddings)\n    if max(scores) > 0.75: # Threshold\n        return {"violation": True, "reason": "Semantically similar to a delivery promise."}\n    return {"violation": False}` },
                        { title: "Approach 3: Judge LLM (The Most Powerful Way)", pros: "The most accurate method. Can understand context, intent, and complex qualitative rules.", cons: "Slower and more resource-intensive. Requires careful prompt engineering for the judge.", code: `# Prompt for the Judge LLM\nSYSTEM: You are a quality assurance bot. The following is a response from a support agent. Does this response promise a specific delivery date or just a shipping window? Respond with only "DELIVERY DATE" or "SHIPPING WINDOW".\n\nUSER: "Your order will be shipped within 2-3 business days and should arrive by Friday, October 27th."\n\nASSISTANT: DELIVERY DATE` }
                    ],
                    placement: { title: "Architectural Placement: Gateway vs. Sidecar", intro: "Where you run your custom scanner depends on its complexity and performance.", gateway: "Fast, stateless checks like **Keyword/Regex** or **Semantic Search with a small, fast model** can run synchronously at the Gateway. This provides immediate, real-time blocking.", sidecar: "Complex, context-aware checks using a **Judge LLM** or those that need the full conversational history must run in the Sidecar. The asynchronous nature of the sidecar allows for these powerful but slower analyses without impacting user-perceived latency." }
                },
                gatewayDeepDive: {
                    title: "LLM Gateway vs Reverse Proxy",
                    intro: "For behavioral control, a simple reverse proxy is insufficient. A reverse proxy manages network traffic, but an LLM Gateway operates at the application layer, understanding and acting upon the content of AI interactions. It's the essential component for enforcing intelligent, content-aware policies.",
                    points: [
                        { icon: 'üîç', title: 'Inspect & Transform Content', description: 'Unlike a proxy, a gateway can read the actual text of prompts and responses. This allows it to perform critical actions like finding and masking PII before data leaves your infrastructure.' },
                        { icon: 'üß©', title: 'Host Specialized Logic', description: 'The gateway acts as a platform to run the specific open-source scanners listed in this report. It orchestrates the chain of security and quality checks on every call.' },
                        { icon: 'ü§ñ', title: 'Understand LLM-Specifics', description: 'It provides a unified API for hundreds of models, handles API key management, and can execute complex logic like retries or fallbacks if a primary model fails.' }
                    ],
                    liteLLMPros: {
                        title: 'LiteLLM: An Open-Source Foundation',
                        intro: 'This architecture recommends LiteLLM as the gateway because it provides powerful features while ensuring the entire system remains open-source and free from vendor lock-in.',
                        pros: [
                            { icon: 'üîÑ', title: 'Model Agnostic', description: 'Provides a single, consistent API endpoint for over 100 different LLM providers. You can swap backend models without changing any of your agent application code.' },
                            { icon: 'üîå', title: 'Extensible Callbacks', description: 'Its powerful callback system is the mechanism for plugging in all the custom scanners and logic. This makes it a highly composable and flexible foundation.' },
                            { icon: 'üìÑ', title: 'Configuration as Code', description: 'All routing, model settings, and keys are managed in a simple YAML file. This aligns with best practices for version-controlled, auditable infrastructure.' }
                        ]
                    }
                },
                sidecarArchitecture: {
                    dataFlow: [
                        { step: 1, title: 'Ingestion', icon: 'üì•', description: 'The OTEL Collector (Go) in the sidecar receives a constant stream of trace data from the Agentic App via gRPC on `localhost`.'},
                        { step: 2, title: 'Batching', icon: 'üì¶', description: 'The `batch` processor groups individual spans into batches to optimize processing and network traffic.'},
                        { step: 3, title: 'Orchestration', icon: '‚öôÔ∏è', description: 'A Custom Go Processor iterates through spans, evaluates simple rules, and triggers deeper analysis for complex cases.'},
                        { step: 4, title: 'Async RPC Call', icon: '‚ö°Ô∏è', description: 'For complex analysis, the Go processor makes a non-blocking gRPC call to the Python Analysis Service within the same pod.'},
                        { step: 5, title: 'Specialized Analysis', icon: 'üî¨', description: 'The Python service uses libraries like `sentence-transformers` or an embedded Judge LLM for tasks like hallucination detection, then returns a structured result.'},
                        { step: 6, title: 'Telemetry Enrichment', icon: '‚úèÔ∏è', description: 'The Go processor receives the analysis result and enriches the original span with new attributes (e.g., `validation.score = 0.85`).'},
                        { step: 7, title: 'Export', icon: 'üì§', description: 'The final, enriched telemetry is exported to a central observability backend like SigNoz or Jaeger.'}
                    ],
                    blueprint: [
                        { component: 'OpenTelemetry Collector', type: 'Go Application', location: 'Sidecar Container', role: 'The Pipeline. Acts as the central nervous system, orchestrating analysis via gRPC calls to the Python service.' },
                        { component: 'OpenTelemetry SDK', type: 'Python Library', location: 'Agentic App Container', role: 'The Sensor. Instruments the main application code, generating the raw trace data that feeds the entire system.' },
                        { component: '`opentelemetry-instrumentation-langchain`', type: 'Python Library', location: 'Agentic App Container', role: 'The Smart Sensor. Auto-enriches traces with LangChain-specific context (chains, tools, docs), making data meaningful.' },
                        { component: '`sentence-transformers`', type: 'Python Library', location: 'Python Analysis Service (Sidecar)', role: 'The Hallucination Detector. Computes vector embeddings for context-response semantic similarity checks.' },
                        { component: '`pymilvus` / `weaviate-client`', type: 'Python Library', location: 'Python Analysis Service (Sidecar)', role: 'The Topic Violation Detector. Queries a central vector DB to check for semantic topic violations.' },
                        { component: 'Embedded Judge LLM (e.g., Phi-3)', type: 'Python Library/Model', location: 'Gateway & Sidecar Containers', role: 'Performs nuanced validation for tasks like prompt injection, advanced content moderation, and qualitative business logic checks.' },
                        { component: 'SigNoz / Jaeger', type: 'Go Application', location: 'Central Observability Cluster', role: 'The Brain. Visualizes traces, creates dashboards, and alerts on custom attributes added by the sidecar.' }
                    ]
                },
                 enforcementStrategy: {
                    title: 'Enforcing Policies on Tools: A Dual Approach',
                    intro: 'Active enforcement requires checks to happen *before* an action is executed. Since the Tool Server is an application component, we must provide secure and easy ways for it to query the Policy Engine, backed by unbypassable infrastructure-level controls.',
                    methods: [
                        { title: 'Method 1: The "Golden Path" SDK', description: 'We provide an internal SDK that abstracts away policy checks. Tool developers add a single line of code to protect their endpoints. The SDK handles the call to OPA and throws an exception if the action is denied, making compliance simple.', code: `from our_internal_sdk import ToolSecurity\n\n@app.post("/run_billing_report")\nasync def run_billing_report(request: BillingRequest):\n  \n  # SDK handles OPA check under the hood.\n  # Throws exception on "deny", stopping execution.\n  ToolSecurity.enforce(\n    user=request.user, \n    action="run_report", \n    resource="billing"\n  )\n  \n  # This code is only reached if OPA returns "allow"\n  result = await generate_sensitive_report(request.params)\n  return {"status": "success", "data": result}` },
                        { title: 'Method 2: Service Mesh Enforcement (Zero Trust)', description: 'For a truly unbypassable control, a service mesh (e.g., Istio) intercepts all network traffic to the tool server. It is configured to query OPA for an authorization decision *before* forwarding the request to the tool. The tool\'s code is never even reached if the policy denies the request.', diagram: [ { item: 'ü§ñ Agent App', arrow: true }, { item: 'üì¶ Service Mesh Proxy', arrow: true }, { item: '‚öñÔ∏è OPA Policy Engine (allow/deny)', arrow: true }, { item: 'üõ†Ô∏è Tool Server' } ] }
                    ],
                    conclusion: 'The best strategy is to use both: provide the SDK for developer ease-of-use and rich application context, and use the service mesh as a mandatory infrastructure backstop to guarantee that no call to a protected resource goes unchecked.'
                },
                mcpEnforcement: {
                    title: "The MCP/Tool: The Final Enforcement Layer",
                    intro: "While the Gateway and Sidecar are essential for perimeter defense and observation, the MCP/Tool Server is the ultimate locus of control for preventing damage to internal systems. It is the last line of defense and has the final say on whether a high-stakes action is executed.",
                    analogy: {
                        title: "The Bank Vault Analogy",
                        points: [
                            { role: "LLM Gateway", is: "The Front-Door Guard", does: "Checks IDs and prevents obvious threats from entering." },
                            { role: "Sidecar", is: "The Surveillance System", does: "Records all activity and detects suspicious patterns for later review." },
                            { role: "MCP/Tool", is: "The Vault Door", does: "Performs a final, mandatory authorization check at the point of action. It trusts nothing and is the ultimate gatekeeper of the resource." }
                        ]
                    },
                    conclusion: "The MCP/Tool is the only component with the ground-truth business context (e.g., real account balances) and the ability to enforce transactional integrity. By performing a synchronous check against the policy engine *before* committing an action, it provides true, preventative control."
                },
                roadmap: {
                    future: [
                        { icon: '‚öñÔ∏è', title: 'Formal Policy Engine (OPA/Cedar)', description: 'Replace the custom rules engine with a standard, battle-tested engine like Open Policy Agent (OPA). This provides a declarative, auditable, and secure way to manage policies as code (using Rego), separating policy logic from application logic and enabling security teams to own policy authorship.' },
                        { icon: 'üß†', title: 'Embedded Judge LLMs', description: 'Deploy small, fast, and private Judge LLMs (e.g., Phi-3, Llama-3-8B) directly within the gateway and sidecar. This enables extremely low-latency, secure, and cost-effective analysis for tasks like prompt injection and qualitative checks.' },
                        { icon: 'üè¶', title: 'Secure Keystore for PII Tokenization', description: 'Enhance PII redaction by integrating with a secure vault (e.g., HashiCorp Vault). Instead of just masking data, the gateway tokenizes it, storing the encrypted value in the vault and replacing it with a non-sensitive token. This allows for auditable, reversible de-tokenization by authorized systems, a critical feature for compliance.' },
                        { icon: 'üì°', title: 'Asynchronous Event Bus for SIEM/SOC', description: 'Configure the OTEL Collector with a second exporter (e.g., Kafka) to stream a filtered set of high-priority security events (policy violations, detected threats) to a dedicated event bus. This decouples observability from security and allows the SOC team to ingest AI-specific security signals into their SIEM (e.g., Splunk, Sentinel) for enterprise-wide correlation.' }
                    ],
                    timeline: [
                        { phase: 1, title: "Foundational Control & Visibility", duration: "1-2 Months", objective: "Achieve immediate control over all LLM traffic and establish baseline observability.", actions: ["Deploy an LLM Gateway (LiteLLM).", "Implement gateway-centric features: PII masking, prompt injection prevention.", "Instrument all agents with the OTEL SDK.", "Deploy a central observability backend (e.g., SigNoz)."], outcome: "All LLM traffic is secured and monitored. Teams have full trace visibility for debugging." },
                        { phase: 2, title: "Advanced Introspective Monitoring", duration: "2-3 Months", objective: "Prove the sidecar pattern and deliver value on a critical advanced feature like hallucination detection.", actions: ["Develop and deploy the v1 Observability Sidecar (OTEL Collector + Python Service).", "Implement the first custom analysis processor for hallucination detection.", "Roll out the sidecar to a key RAG-based application.", "Analyze and refine detection results."], outcome: "Functioning sidecar architecture flagging potential hallucinations in production." },
                        { phase: 3, title: "Dynamic Policy Enforcement & Rollout", duration: "Ongoing", objective: "Mature the sidecar into a full-featured, dynamic policy enforcement engine.", actions: ["Implement a custom Rules Engine processor in the sidecar.", "Define and encode custom business logic validations as declarative rules.", "Develop the first custom business logic scanner (e.g., 'no delivery dates').", "Standardize the 'Agent + Sidecar' deployment pattern for all teams."], outcome: "A mature, scalable, and dynamic AI Control Plane is operational, providing robust governance." },
                        { phase: 4, title: "Enterprise Hardening & Integration", duration: "Future", objective: "Evolve the control plane into a fully hardened, enterprise-integrated system ready for the most stringent security and compliance requirements.", actions: [
                            "Replace the custom rules engine with a formal Policy Engine (e.g., OPA).", 
                            "Integrate the gateway with a secure Keystore (e.g., HashiCorp Vault) for PII tokenization.", 
                            "Add a dedicated OTEL exporter to stream security events to a SIEM via an Event Bus (e.g., Kafka).", 
                            "Develop and roll out the dual SDK/Service Mesh enforcement strategy for MCP/Tool servers.", 
                            "Deploy embedded Judge LLMs in the gateway and sidecar for low-latency, nuanced validations.",
                            "Integrate an eBPF agent to capture kernel-level system data for uninstrumented code and deeper security analysis."
                        ], outcome: "A fully enterprise-grade AI Control Plane, integrated with corporate security (SOC/SIEM) and IT systems, providing auditable, preventative, and robust governance." }
                    ]
                },
                diagramInfo: {
                    'agent-pod': "The Application Pod contains the agent and its sidecar. They share a network namespace, allowing secure, low-latency communication.",
                    'mcp': "Internal services the agent interacts with. This includes RAG databases for context and other tools providing business capabilities.",
                    'backend': "Shared, cluster-level services that support the control plane, such as the policy engine and secure keystore.",
                    'gateway': "The single entry/exit point for all external LLM traffic. It enforces perimeter security and can use an embedded Judge LLM for fast prompt analysis.",
                    'external': "Third-party services, including the primary LLM providers (OpenAI, Anthropic) and potentially more powerful external Judge LLMs for high-stakes validation.",
                    default: "Hover over or tap a component to learn more."
                },
                features: {
                    labels: [
                        'PII Detection', 'Prompt Injection', 'Content Moderation', 
                        'Data Leakage Prevention', 'Hallucination Detection', 'Business Logic Validation', 
                        'Topic Enforcement', 'Competitor Mentions', 'Cost/Budget Control', 'Caching/Performance', 
                        'Auditing & Logging', 'A/B Testing & Routing'
                    ],
                    info: [
                        'Identifies and redacts personally identifiable information like names and addresses.',
                        'Prevents malicious user inputs designed to hijack the agent\'s instructions.',
                        'Filters for toxic, harmful, or otherwise inappropriate language.',
                        'Stops sensitive or confidential corporate data from being exposed in responses.',
                        'Verifies that the agent\'s claims are factually grounded in its provided context.',
                        'Ensures the agent\'s actions comply with specific, custom operational rules.',
                        'Keeps the agent\'s conversation focused on its designated purpose and domain.',
                        'Prevents the agent from naming or promoting competitor products or services.',
                        'Tracks and limits token usage to manage operational spend.',
                        'Speeds up responses and reduces costs by storing and reusing answers to common queries.',
                        'Creates a detailed, tamper-proof record of all agent interactions for compliance.',
                        'Directs user traffic to different models or prompts to test and optimize performance.'
                    ],
                    gateway:  [100, 100, 100, 80, 5, 10, 10, 20, 100, 100, 100, 100],
                    sidecar:  [20, 20, 50, 100, 100, 60, 100, 100, 20, 20, 80, 20],
                    mcp:      [0, 5, 10, 90, 80, 100, 20, 20, 0, 0, 30, 0],
                    details: [
                        { rationale: { gateway: 'Primary locus. Real-time scanning and redaction of prompts/responses is a core gateway function.', sidecar: 'Can perform deeper, asynchronous PII scans on internal data or tool outputs if necessary.', mcp: 'Should not see raw PII. Operates on data that has already been sanitized by the gateway.' }},
                        { rationale: { gateway: 'Primary locus. Acts as the first line of defense, using fast heuristic and model-based scanners to block malicious prompts before they are processed.', sidecar: 'Secondary locus. Can detect more complex, multi-turn injection attempts by analyzing the full conversational trace.', mcp: 'Limited role. Must have basic input validation but relies on the gateway for primary security.' }},
                        { rationale: { gateway: 'Primary locus. Enforces broad, stateless content policies (e.g., profanity, toxicity) on all traffic.', sidecar: 'Can enforce more nuanced, context-aware content policies by analyzing conversational history.', mcp: 'Limited role. Tools generally focus on their specific task, not broad content moderation.' }},
                        { rationale: { gateway: 'Strong role. Can prevent leakage of well-defined secrets (e.g., API key patterns) or PII.', sidecar: 'Primary locus for complex *detection*. Can detect if an agent is leaking information learned in one user session to another by analyzing stateful traces.', mcp: 'Primary locus for *prevention*. The tool must have its own authorization checks to prevent it from returning data to an unauthorized user, providing the final, unbypassable control.' }},
                        { rationale: { gateway: 'Very limited role. Has no access to the grounding context needed for this check.', sidecar: 'Primary locus for detection. Has access to the full application trace, including both the retrieved context and the final response, which are required for comparison.', mcp: 'Strong supporting role. The RAG Vector DB is the source of truth; the sidecar must query it to perform the check.' }},
                         { rationale: { gateway: 'Limited role. Can handle very simple, stateless business rules (e.g., block certain keywords).', sidecar: 'Primary locus for *detection*. Can analyze the full trace to see if a rule was violated, which is essential for auditing and alerting.', mcp: 'Primary locus for *enforcement*. The tool contains the ground-truth business context (e.g., inventory) and is the only component that can prevent a damaging action before it happens.' }},
                         { rationale: { gateway: 'Limited role. Can perform simple keyword-based topic filtering.', sidecar: 'Primary locus. Can perform semantic searches on conversational history to determine if the agent is drifting off-topic in a nuanced way.', mcp: 'N/A. Not a tool-level concern.' }},
                         { rationale: { gateway: 'Strong role. Can use simple keyword or regex scanners to block competitor names in real-time.', sidecar: 'Can perform more advanced semantic detection if a competitor is mentioned indirectly.', mcp: 'N/A. Not a tool-level concern.' }},
                        { rationale: { gateway: 'Primary locus. It is the only component that sees every model call and can track token usage, enforce budgets, and block requests that would exceed limits.', sidecar: 'Can provide cost attribution by analyzing traces, but cannot enforce budgets in real-time.', mcp: 'N/A. Does not interact with the external LLM.' }},
                        { rationale: { gateway: 'Primary locus. Can cache identical LLM requests to reduce latency and cost, serving a cached response instead of calling the LLM again.', sidecar: 'N/A. Observes but does not intervene in the request/response path.', mcp: 'Tools can implement their own caching, but the gateway provides a global cache for all LLM calls.' }},
                        { rationale: { gateway: 'Primary locus. Generates a comprehensive, centralized log of every prompt, response, and policy decision for compliance and auditing.', sidecar: 'Enriches the audit trail with deep, context-aware insights into *why* an agent made a decision.', mcp: 'Provides logs for tool-specific actions, which are correlated with the main audit trail.' }},
                        { rationale: { gateway: 'Primary locus. Can be configured to route a percentage of traffic to different models or prompts for A/B testing performance and quality.', sidecar: 'Analyzes and compares the performance of the A/B tests by examining the resulting traces.', mcp: 'N/A. Routing decisions happen at the gateway, before a tool is ever called.' }},
                    ]
                }
            };
            
            // --- ALL RENDER AND SETUP FUNCTIONS ARE DEFINED HERE ---
            
            function renderArchitecture() {
                const section = document.getElementById('architecture');
                section.innerHTML = `
                    <div class="max-w-6xl mx-auto">
                        <h1 class="text-4xl md:text-6xl font-bold mb-6 text-stone-800">
                            Agentic AI Control Plane
                        </h1>
                        <p class="text-lg md:text-xl text-stone-600 mb-12 max-w-4xl mx-auto leading-relaxed">
                            An Interactive Guide to Production-Grade Observability and Control for AI Systems
                        </p>

                        <div class="bg-white rounded-xl shadow-lg p-8 mb-12">
                            <h2 class="text-2xl font-bold mb-6 text-center text-stone-800">System Architecture Overview</h2>
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <div class="card p-6 hover-item" data-info="gateway">
                                    <div class="text-3xl mb-4">üö™</div>
                                    <h3 class="text-xl font-semibold mb-2 text-teal-600">LLM Gateway</h3>
                                    <p class="text-stone-600">Single entry point for all LLM traffic with real-time security scanning and policy enforcement</p>
                                </div>
                                <div class="card p-6 hover-item" data-info="agent-pod">
                                    <div class="text-3xl mb-4">ü§ñ</div>
                                    <h3 class="text-xl font-semibold mb-2 text-teal-600">Agent + Sidecar</h3>
                                    <p class="text-stone-600">Application pod with observability sidecar for deep behavioral analysis</p>
                                </div>
                                <div class="card p-6 hover-item" data-info="mcp">
                                    <div class="text-3xl mb-4">üõ†Ô∏è</div>
                                    <h3 class="text-xl font-semibold mb-2 text-teal-600">MCP/Tool Server</h3>
                                    <p class="text-stone-600">Final enforcement layer with business context and transactional control</p>
                                </div>
                            </div>
                            <div class="mt-8 p-4 bg-stone-50 rounded-lg">
                                <p id="diagram-info" class="text-center text-stone-600 italic">
                                    ${appData.diagramInfo.default}
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            }

            function renderFeaturesChart() {
                const featuresHtml = `
                    <div class="bg-white rounded-xl shadow-lg p-8">
                        <h2 class="text-2xl font-bold mb-6 text-center text-stone-800">Control Plane Feature Matrix</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse">
                                <thead>
                                    <tr class="bg-stone-100">
                                        <th class="border border-stone-200 p-3 text-left font-semibold">Feature</th>
                                        <th class="border border-stone-200 p-3 text-center font-semibold text-teal-600">Gateway</th>
                                        <th class="border border-stone-200 p-3 text-center font-semibold text-teal-600">Sidecar</th>
                                        <th class="border border-stone-200 p-3 text-center font-semibold text-teal-600">MCP/Tool</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${appData.features.labels.map((label, i) => `
                                        <tr class="hover:bg-stone-50 cursor-pointer feature-row" data-index="${i}">
                                            <td class="border border-stone-200 p-3 font-medium">${label}</td>
                                            <td class="border border-stone-200 p-3 text-center">
                                                <div class="w-full bg-stone-200 rounded-full h-2">
                                                    <div class="bg-teal-500 h-2 rounded-full" style="width: ${appData.features.gateway[i]}%"></div>
                                                </div>
                                            </td>
                                            <td class="border border-stone-200 p-3 text-center">
                                                <div class="w-full bg-stone-200 rounded-full h-2">
                                                    <div class="bg-teal-500 h-2 rounded-full" style="width: ${appData.features.sidecar[i]}%"></div>
                                                </div>
                                            </td>
                                            <td class="border border-stone-200 p-3 text-center">
                                                <div class="w-full bg-stone-200 rounded-full h-2">
                                                    <div class="bg-teal-500 h-2 rounded-full" style="width: ${appData.features.mcp[i]}%"></div>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <div id="feature-details" class="mt-6 p-4 bg-stone-50 rounded-lg hidden">
                            <h3 class="font-semibold mb-2 text-stone-800">Feature Details</h3>
                            <p id="feature-description" class="text-stone-600 mb-4"></p>
                            <div class="space-y-2">
                                <div><strong>Gateway:</strong> <span id="gateway-rationale"></span></div>
                                <div><strong>Sidecar:</strong> <span id="sidecar-rationale"></span></div>
                                <div><strong>MCP/Tool:</strong> <span id="mcp-rationale"></span></div>
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('architecture').innerHTML += featuresHtml;
            }

            function renderGatewayDeepDive() {
                const section = document.getElementById('gateway');
                const data = appData.gatewayDeepDive;
                section.innerHTML = `
                    <div class="max-w-6xl mx-auto">
                        <h2 class="text-3xl font-bold mb-8 text-center text-stone-800">${data.title}</h2>
                        <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                            <p class="text-lg text-stone-600 mb-8 leading-relaxed">${data.intro}</p>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                                ${data.points.map(point => `
                                    <div class="card p-6">
                                        <div class="text-3xl mb-4">${point.icon}</div>
                                        <h3 class="text-xl font-semibold mb-3 text-teal-600">${point.title}</h3>
                                        <p class="text-stone-600">${point.description}</p>
                                    </div>
                                `).join('')}
                            </div>

                            <div class="bg-teal-50 rounded-lg p-6">
                                <h3 class="text-2xl font-bold mb-4 text-stone-800">${data.liteLLMPros.title}</h3>
                                <p class="text-stone-600 mb-6">${data.liteLLMPros.intro}</p>

                                <div class="space-y-4">
                                    ${data.liteLLMPros.pros.map(pro => `
                                        <div class="flex items-start space-x-3">
                                            <div class="text-xl">${pro.icon}</div>
                                            <div>
                                                <h4 class="font-semibold text-stone-800">${pro.title}</h4>
                                                <p class="text-stone-600">${pro.description}</p>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            function renderSidecarArchitecture() {
                const section = document.getElementById('sidecar');
                const data = appData.sidecarArchitecture;
                section.innerHTML = `
                    <div class="max-w-6xl mx-auto">
                        <h2 class="text-3xl font-bold mb-8 text-center text-stone-800">Sidecar Architecture</h2>

                        <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                            <h3 class="text-2xl font-bold mb-6 text-stone-800">Data Flow Pipeline</h3>
                            <div class="space-y-4">
                                ${data.dataFlow.map(step => `
                                    <div class="demo-step" data-icon="${step.step}">
                                        <div class="flex items-start space-x-4">
                                            <div class="text-2xl">${step.icon}</div>
                                            <div>
                                                <h4 class="text-lg font-semibold text-teal-600">${step.title}</h4>
                                                <p class="text-stone-600">${step.description}</p>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-8">
                            <h3 class="text-2xl font-bold mb-6 text-stone-800">Component Blueprint</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full border-collapse">
                                    <thead>
                                        <tr class="bg-stone-100">
                                            <th class="border border-stone-200 p-3 text-left font-semibold">Component</th>
                                            <th class="border border-stone-200 p-3 text-left font-semibold">Type</th>
                                            <th class="border border-stone-200 p-3 text-left font-semibold">Location</th>
                                            <th class="border border-stone-200 p-3 text-left font-semibold">Role</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${data.blueprint.map(comp => `
                                            <tr class="hover:bg-stone-50">
                                                <td class="border border-stone-200 p-3 font-medium text-teal-600">${comp.component}</td>
                                                <td class="border border-stone-200 p-3">${comp.type}</td>
                                                <td class="border border-stone-200 p-3">${comp.location}</td>
                                                <td class="border border-stone-200 p-3 text-stone-600">${comp.role}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            }

            function renderEBPF() {
                const section = document.getElementById('ebpf');
                section.innerHTML = `
                    <div class="max-w-6xl mx-auto">
                        <h2 class="text-3xl font-bold mb-8 text-center text-stone-800">eBPF Integration</h2>

                        <div class="bg-white rounded-xl shadow-lg p-8">
                            <div class="text-center mb-8">
                                <div class="text-6xl mb-4">üî¨</div>
                                <h3 class="text-2xl font-bold text-stone-800 mb-4">Kernel-Level Observability</h3>
                                <p class="text-lg text-stone-600 leading-relaxed max-w-4xl mx-auto">
                                    eBPF provides unprecedented visibility into system calls, network traffic, and resource usage at the kernel level.
                                    This enables detection of uninstrumented code behavior and advanced security monitoring for AI workloads.
                                </p>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="card p-6">
                                    <h4 class="text-xl font-semibold mb-4 text-teal-600">üõ°Ô∏è Security Monitoring</h4>
                                    <ul class="space-y-2 text-stone-600">
                                        <li>‚Ä¢ Detect privilege escalation attempts</li>
                                        <li>‚Ä¢ Monitor file access patterns</li>
                                        <li>‚Ä¢ Track network connections</li>
                                        <li>‚Ä¢ Identify suspicious system calls</li>
                                    </ul>
                                </div>

                                <div class="card p-6">
                                    <h4 class="text-xl font-semibold mb-4 text-teal-600">üìä Performance Insights</h4>
                                    <ul class="space-y-2 text-stone-600">
                                        <li>‚Ä¢ CPU and memory usage per process</li>
                                        <li>‚Ä¢ I/O latency and throughput</li>
                                        <li>‚Ä¢ Container resource consumption</li>
                                        <li>‚Ä¢ Network bandwidth utilization</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            function renderMcpEnforcement() {
                const section = document.getElementById('mcp-enforcement');
                const data = appData.mcpEnforcement;
                section.innerHTML = `
                    <div class="max-w-6xl mx-auto">
                        <h2 class="text-3xl font-bold mb-8 text-center text-stone-800">${data.title}</h2>

                        <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                            <p class="text-lg text-stone-600 mb-8 leading-relaxed">${data.intro}</p>

                            <div class="bg-amber-50 rounded-lg p-6 mb-8">
                                <h3 class="text-xl font-bold mb-4 text-stone-800">${data.analogy.title}</h3>
                                <div class="space-y-3">
                                    ${data.analogy.points.map(point => `
                                        <div class="flex items-start space-x-3">
                                            <div class="font-semibold text-teal-600 min-w-0 flex-shrink-0">${point.role}:</div>
                                            <div>
                                                <span class="font-medium">${point.is}</span> - ${point.does}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <div class="bg-teal-50 rounded-lg p-6">
                                <p class="text-stone-700 leading-relaxed">${data.conclusion}</p>
                            </div>
                        </div>
                    </div>
                `;
            }

            function renderJudgeLlmContent() {
                const section = document.getElementById('judge-llm');
                section.innerHTML = `
                    <div class="max-w-6xl mx-auto">
                        <h2 class="text-3xl font-bold mb-8 text-center text-stone-800">Judge LLM Integration</h2>

                        <div class="bg-white rounded-xl shadow-lg p-8">
                            <div class="text-center mb-8">
                                <div class="text-6xl mb-4">‚öñÔ∏è</div>
                                <h3 class="text-2xl font-bold text-stone-800 mb-4">Embedded Judge LLMs</h3>
                                <p class="text-lg text-stone-600 leading-relaxed max-w-4xl mx-auto">
                                    Small, fast, and private Judge LLMs (e.g., Phi-3, Llama-3-8B) deployed directly within the gateway and sidecar
                                    enable extremely low-latency, secure, and cost-effective analysis for complex validation tasks.
                                </p>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="card p-6">
                                    <h4 class="text-xl font-semibold mb-4 text-teal-600">üöÄ Low Latency</h4>
                                    <p class="text-stone-600">
                                        On-premise deployment eliminates network round trips,
                                        enabling real-time analysis without impacting user experience.
                                    </p>
                                </div>

                                <div class="card p-6">
                                    <h4 class="text-xl font-semibold mb-4 text-teal-600">üîí Privacy</h4>
                                    <p class="text-stone-600">
                                        Sensitive data never leaves your infrastructure,
                                        maintaining complete control over information security.
                                    </p>
                                </div>

                                <div class="card p-6">
                                    <h4 class="text-xl font-semibold mb-4 text-teal-600">üí∞ Cost Effective</h4>
                                    <p class="text-stone-600">
                                        Eliminate per-token costs for validation by running
                                        efficient models on your own hardware.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            function renderRoadmap() {
                const section = document.getElementById('roadmap');
                const data = appData.roadmap;
                section.innerHTML = `
                    <div class="max-w-6xl mx-auto">
                        <h2 class="text-3xl font-bold mb-8 text-center text-stone-800">Development Roadmap</h2>

                        <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                            <h3 class="text-2xl font-bold mb-6 text-stone-800">Future Enhancements</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                ${data.future.map(item => `
                                    <div class="card p-6">
                                        <div class="text-3xl mb-4">${item.icon}</div>
                                        <h4 class="text-lg font-semibold mb-3 text-teal-600">${item.title}</h4>
                                        <p class="text-stone-600">${item.description}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-8">
                            <h3 class="text-2xl font-bold mb-6 text-stone-800">Implementation Timeline</h3>
                            <div class="space-y-8">
                                ${data.timeline.map(phase => `
                                    <div class="timeline-item pl-6 pb-8 last:pb-0">
                                        <div class="timeline-dot w-4 h-4 rounded-full absolute -ml-8 mt-1"></div>
                                        <div class="flex flex-col md:flex-row md:items-start md:space-x-8">
                                            <div class="md:w-1/4 mb-4 md:mb-0">
                                                <div class="bg-teal-100 text-teal-800 px-3 py-1 rounded-full text-sm font-semibold inline-block">
                                                    Phase ${phase.phase}
                                                </div>
                                                <div class="text-stone-500 text-sm mt-1">${phase.duration}</div>
                                            </div>
                                            <div class="md:w-3/4">
                                                <h4 class="text-xl font-semibold mb-2 text-stone-800">${phase.title}</h4>
                                                <p class="text-stone-600 mb-4">${phase.objective}</p>
                                                <div class="mb-4">
                                                    <h5 class="font-semibold text-stone-700 mb-2">Key Actions:</h5>
                                                    <ul class="list-disc list-inside space-y-1 text-stone-600">
                                                        ${phase.actions.map(action => `<li>${action}</li>`).join('')}
                                                    </ul>
                                                </div>
                                                <div class="bg-green-50 p-3 rounded-lg">
                                                    <span class="font-semibold text-green-800">Outcome:</span>
                                                    <span class="text-green-700">${phase.outcome}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            function renderGatewayScanners() {
                const section = document.getElementById('scanners');
                const scanners = appData.gatewayScanners;
                const priorities = appData.scannerPriorities;

                section.innerHTML = `
                    <div class="max-w-6xl mx-auto">
                        <h2 class="text-3xl font-bold mb-8 text-center text-stone-800">Gateway Scanners</h2>

                        <div class="space-y-8">
                            ${priorities.map((priority, idx) => `
                                <div class="bg-white rounded-xl shadow-lg p-8">
                                    <h3 class="text-xl font-bold mb-4 text-teal-600">${priority.title}</h3>
                                    <p class="text-stone-600 mb-6 leading-relaxed">${priority.rationale}</p>

                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        ${scanners.filter(s => s.priority === idx + 1).map(scanner => `
                                            <div class="card p-6">
                                                <div class="flex items-start justify-between mb-3">
                                                    <h4 class="font-semibold text-stone-800">${scanner.scannerName}</h4>
                                                    <span class="text-xs px-2 py-1 bg-${scanner.method === 'Model-Based' ? 'purple' : 'blue'}-100 text-${scanner.method === 'Model-Based' ? 'purple' : 'blue'}-800 rounded">
                                                        ${scanner.method}
                                                    </span>
                                                </div>
                                                <p class="text-sm text-stone-600 mb-4">${scanner.description}</p>
                                                ${scanner.link ? `
                                                    <a href="${scanner.link}" target="_blank" class="text-teal-600 hover:text-teal-800 text-sm font-medium">
                                                        Learn More ‚Üí
                                                    </a>
                                                ` : ''}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            function renderDemoScenarios() {
                const section = document.getElementById('demos');
                section.innerHTML = `
                    <div class="max-w-6xl mx-auto">
                        <h2 class="text-3xl font-bold mb-8 text-center text-stone-800">Demo Scenarios</h2>

                        <div class="bg-white rounded-xl shadow-lg p-8">
                            <div class="text-center">
                                <div class="text-6xl mb-4">üé≠</div>
                                <h3 class="text-2xl font-bold text-stone-800 mb-4">Interactive Demonstrations</h3>
                                <p class="text-lg text-stone-600 leading-relaxed max-w-4xl mx-auto">
                                    Explore real-world scenarios where the AI Control Plane prevents common issues and ensures
                                    compliant, safe AI behavior across different use cases and industries.
                                </p>
                            </div>

                            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <div class="card p-6">
                                    <h4 class="text-xl font-semibold mb-4 text-teal-600">üí≥ Financial Services</h4>
                                    <p class="text-stone-600">
                                        Banking chatbot with PII protection, fraud detection, and regulatory compliance validation.
                                    </p>
                                </div>

                                <div class="card p-6">
                                    <h4 class="text-xl font-semibold mb-4 text-teal-600">üè• Healthcare</h4>
                                    <p class="text-stone-600">
                                        Medical assistant with HIPAA compliance, medical accuracy validation, and safety guardrails.
                                    </p>
                                </div>

                                <div class="card p-6">
                                    <h4 class="text-xl font-semibold mb-4 text-teal-600">üõí E-commerce</h4>
                                    <p class="text-stone-600">
                                        Customer support agent with inventory validation, pricing controls, and brand compliance.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            function renderCustomScanners() {
                const section = document.getElementById('custom-scanners');
                const data = appData.customScanners;
                section.innerHTML = `
                    <div class="max-w-6xl mx-auto">
                        <h2 class="text-3xl font-bold mb-8 text-center text-stone-800">${data.title}</h2>

                        <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                            <p class="text-lg text-stone-600 mb-8 leading-relaxed">${data.intro}</p>

                            <div class="space-y-8">
                                ${data.implementations.map((impl, idx) => `
                                    <div class="border-l-4 border-teal-500 pl-6">
                                        <h3 class="text-xl font-bold mb-4 text-stone-800">${impl.title}</h3>

                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                            <div>
                                                <h4 class="font-semibold text-green-600 mb-2">‚úÖ Pros:</h4>
                                                <p class="text-stone-600">${impl.pros}</p>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-red-600 mb-2">‚ùå Cons:</h4>
                                                <p class="text-stone-600">${impl.cons}</p>
                                            </div>
                                        </div>

                                        <div class="bg-stone-800 rounded-lg p-4 overflow-x-auto">
                                            <pre class="text-stone-100 text-sm"><code>${impl.code}</code></pre>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-8">
                            <h3 class="text-2xl font-bold mb-6 text-stone-800">${data.placement.title}</h3>
                            <p class="text-stone-600 mb-6">${data.placement.intro}</p>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-blue-50 p-6 rounded-lg">
                                    <h4 class="text-lg font-semibold mb-3 text-blue-800">üö™ Gateway Placement</h4>
                                    <p class="text-blue-700">${data.placement.gateway}</p>
                                </div>

                                <div class="bg-purple-50 p-6 rounded-lg">
                                    <h4 class="text-lg font-semibold mb-3 text-purple-800">üì° Sidecar Placement</h4>
                                    <p class="text-purple-700">${data.placement.sidecar}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            function renderToolEnforcement() {
                const section = document.getElementById('tool-enforcement');
                const data = appData.enforcementStrategy;
                section.innerHTML = `
                    <div class="max-w-6xl mx-auto">
                        <h2 class="text-3xl font-bold mb-8 text-center text-stone-800">${data.title}</h2>

                        <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                            <p class="text-lg text-stone-600 mb-8 leading-relaxed">${data.intro}</p>

                            <div class="space-y-8">
                                ${data.methods.map(method => `
                                    <div class="border-l-4 border-teal-500 pl-6">
                                        <h3 class="text-xl font-bold mb-4 text-stone-800">${method.title}</h3>
                                        <p class="text-stone-600 mb-6">${method.description}</p>

                                        ${method.code ? `
                                            <div class="bg-stone-800 rounded-lg p-4 overflow-x-auto">
                                                <pre class="text-stone-100 text-sm"><code>${method.code}</code></pre>
                                            </div>
                                        ` : ''}

                                        ${method.diagram ? `
                                            <div class="flex items-center justify-center space-x-4 mt-6">
                                                ${method.diagram.map(item =>
                                                    item.arrow ?
                                                        `<div class="text-center">
                                                            <div class="bg-teal-100 text-teal-800 px-4 py-2 rounded-lg font-medium">${item.item}</div>
                                                        </div>
                                                        <div class="text-teal-500 text-2xl">‚Üí</div>` :
                                                        `<div class="text-center">
                                                            <div class="bg-teal-100 text-teal-800 px-4 py-2 rounded-lg font-medium">${item.item}</div>
                                                        </div>`
                                                ).join('')}
                                            </div>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            </div>

                            <div class="mt-8 bg-teal-50 rounded-lg p-6">
                                <h3 class="text-lg font-semibold mb-3 text-stone-800">Conclusion</h3>
                                <p class="text-stone-700">${data.conclusion}</p>
                            </div>
                        </div>
                    </div>
                `;
            }

            function setupArchitectureDiagramInteractivity() {
                const hoverItems = document.querySelectorAll('.hover-item');
                const diagramInfo = document.getElementById('diagram-info');

                hoverItems.forEach(item => {
                    item.addEventListener('mouseenter', () => {
                        const infoKey = item.getAttribute('data-info');
                        diagramInfo.textContent = appData.diagramInfo[infoKey] || appData.diagramInfo.default;
                        diagramInfo.classList.remove('italic');
                        diagramInfo.classList.add('font-medium');
                    });

                    item.addEventListener('mouseleave', () => {
                        diagramInfo.textContent = appData.diagramInfo.default;
                        diagramInfo.classList.add('italic');
                        diagramInfo.classList.remove('font-medium');
                    });
                });

                // Feature matrix interactivity
                const featureRows = document.querySelectorAll('.feature-row');
                const featureDetails = document.getElementById('feature-details');
                const featureDescription = document.getElementById('feature-description');
                const gatewayRationale = document.getElementById('gateway-rationale');
                const sidecarRationale = document.getElementById('sidecar-rationale');
                const mcpRationale = document.getElementById('mcp-rationale');

                featureRows.forEach(row => {
                    row.addEventListener('click', () => {
                        const index = parseInt(row.getAttribute('data-index'));
                        const details = appData.features.details[index];

                        if (details) {
                            featureDescription.textContent = appData.features.info[index];
                            gatewayRationale.textContent = details.rationale.gateway;
                            sidecarRationale.textContent = details.rationale.sidecar;
                            mcpRationale.textContent = details.rationale.mcp;
                            featureDetails.classList.remove('hidden');
                        }
                    });
                });
            }

            function setupSmoothScrolling() {
                const navLinks = document.querySelectorAll('a[href^="#"]');
                navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetId = link.getAttribute('href').substring(1);
                        const targetElement = document.getElementById(targetId);
                        if (targetElement) {
                            targetElement.scrollIntoView({
                                behavior: 'smooth',
                                block: 'start'
                            });
                        }
                    });
                });
            }

            function generateDemoScenarios() {
                // Demo scenarios are generated dynamically but kept simple for this implementation
                appData.demoScenarios = [
                    { title: "Financial Services Demo", description: "Banking chatbot with compliance controls" },
                    { title: "Healthcare Demo", description: "Medical assistant with safety guardrails" },
                    { title: "E-commerce Demo", description: "Customer support with business logic validation" }
                ];
            }

            // --- INITIALIZATION ---
            function initializeApp() {
                const main = document.querySelector('main');
                main.innerHTML = `
                    <section id="architecture" class="mb-16 md:mb-24 text-center scroll-mt-20"></section>
                    <section id="gateway" class="mb-16 md:mb-24 scroll-mt-20"></section>
                    <section id="scanners" class="mb-16 md:mb-24 scroll-mt-20"></section>
                    <section id="sidecar" class="mb-16 md:mb-24 scroll-mt-20"></section>
                    <section id="ebpf" class="mb-16 md:mb-24 scroll-mt-20"></section>
                    <section id="mcp-enforcement" class="mb-16 md:mb-24 scroll-mt-20"></section>
                    <section id="judge-llm" class="mb-16 md:mb-24 scroll-mt-20"></section>
                    <section id="roadmap" class="scroll-mt-20"></section>
                    <div id="policies-and-demos">
                        <section id="demos" class="mb-16 md:mb-24 scroll-mt-20"></section>
                        <section id="custom-scanners" class="mb-16 md:mb-24 scroll-mt-20"></section>
                        <section id="tool-enforcement" class="mb-16 md:mb-24 scroll-mt-20"></section>
                    </div>
                `;

                generateDemoScenarios();
                renderArchitecture();
                renderFeaturesChart();
                renderGatewayDeepDive();
                renderSidecarArchitecture();
                renderEBPF();
                renderMcpEnforcement();
                renderJudgeLlmContent();
                renderGatewayScanners();
                renderDemoScenarios();
                renderCustomScanners();
                renderToolEnforcement();
                renderRoadmap();
                setupSmoothScrolling();
                setupArchitectureDiagramInteractivity();
            }

            initializeApp();
        });
    </script>
</body>
</html>

